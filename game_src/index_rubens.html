<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 50px;
                padding-bottom: 20px;
            }
            .col-md-12 {
                border: 2px solid black;
                border-radius: 10px 10px 10px 10px;
                margin: 5px;
            }
            .center {
                text-align: center;
            }
            .campo {
              margin-bottom: 25px;
              background-color: #ffcc00;
              padding: 1px;
              height: 515px;
            }
            .campo img {position: relative; float: left }
            .table-no-border>thead>tr>th, 
            .table-no-border>tbody>tr>th, 
            .table-no-border>tfoot>tr>th, 
            .table-no-border>thead>tr>td, 
            .table-no-border>tbody>tr>td, 
            .table-no-border>tfoot>tr>td {

              border-top: none;
              border-spacing: 0px; 
              border-collapse: collapse;
            }
            .marginpadding {
              margin: 0;
              padding: 0;
            }
        </style>
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Alla scoperta dell'informatica</a>
        </div>
      </div>
    </div>

    <div class="container">
      <!-- Example row of columns -->
      <div class="row"><h1 class="center"> <img id="Pres_gioco" src="http://icons.iconarchive.com/icons/dapino/callcenter-girls/64/callcenter-girls-glasses-icon.png" style="margin: 0; padding: 0;"> Alla scoperta dell'informatica</h1></div>
      <div class="row" id="campo_totale">
        <div class="col-md-12 marginpadding" id="contenitore_campo_console">
          <div class="col-md-8">
            <h2 class="center">Campo di gioco</h2>
            <div class="campo">
            </div>
          </div>
          <div class="col-md-4">  
            <h2 class="center">Console</h2>
            <p>Inserisci comando</p>
            <p class="center"><input type="text" class="form-control" id="comando"> <br /> <a class="btn btn-default" href="#" role="button" onclick="esegui_comando()">Esegui</a> <a class="btn btn-default" href="#" role="button">Cancella</a></p>
            <p><h2 class="center">Log eventi</h2><div id="log_eventi" style="height: 310px; overflow: scroll;"><p>campo spiegazione errori</p></div></p>
          </div>
        </div>
      </div>

      <hr>

      <footer>
        <p>&copy; Caroti Rubens e Daniel Vedovato 2014</p>
      </footer>
    </div> <!-- /container -->        <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
        <script>window.jQuery || document.write('<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"><\/script>')</script>

        <script src="js/vendor/bootstrap.min.js"></script>

        <script src="js/main.js"></script>

        <script>
		  /*Variabili*/{
			  /*Debug*/{
				  var var_debug = false;
				  var var_griglia = true;
				  var avvio_rapido = true;
			  }
			  
			  /*posizioni*/{
				  //array posizioni
				  var posizioni = 
					[
					// {coordinate:"", oggetto:"Personaggio", number:0, riga:0, colonna:0}, //personaggio
					// {coordinate:"", oggetto:"Exit",        number:0, riga:0, colonna:0}, //exit
					 {coordinate:"0_0", oggetto:'Ostacolo',    number:0, riga:0, colonna:0}  //ostacolo
					];
			  }
			  
			  /*campo*/{
				  var codice_campo_console = $('#campo_totale').html();
				  
				  //sfondo
				  var background_color_campo = var_griglia ? 'black' : '#ffcc00';
				  
				  var sep_rig_col = "_"; //attenzione a caratteri accettati per id
				  
				  //marcatore celle vuote
				  var pos_vuota        =   "xxxx"
				                         + "<p>"
										 + "xxxx";
				  //marcatore celle attraversate
				  var pos_attraversata =   "<b style='color: " + background_color_campo + ";'>...</b>*<b style='color: " + background_color_campo + ";'>...</b>"
				                         + "<p>"
										 + "<b style='color: " + background_color_campo + ";'>...</b>*<b style='color: " + background_color_campo + ";'>...</b>";

				  //dimensioni:
				  var num_righe = 8;//ex16
				  var num_colonne = 14;
				  
				  
			  }
			  
			  /*sprite*/{
				//personaggio:
				var personaggio_img = 
				   //'<img id="personaggio_01" src="http://icons.iconarchive.com/icons/itzikgur/my-seven/32/Girls-Blue-Dress-icon.png" style="margin: 0; padding: 0;">';
				   '<img id="personaggio_02" src="http://icons.iconarchive.com/icons/raindropmemory/harmonia-pastelis/32/hp-girl-icon.png" style="margin: 0; padding: 0;">';
			  
				//uscita:
				var exit_img = 
				   '<img id="exit_01" src="http://icons.iconarchive.com/icons/iconsmind/outline/32/Door-icon.png" style="margin: 0; padding: 0;">';
			  
			  }
		  
			  /*Obbiettivi*/{
				var num_obbiettivi = 0;
				var livello = 1;
				var mappa = 1
			  }
			  
			  /*Log:*/{
				  //orario avvio:
				  data_avvio_gioco = new Date();
				  
				  //Log:
				  var var_log = ((data_avvio_gioco.toTimeString()).split(' ')[0]) + " : <b style='color: green;'> Start</b><br />";
			  }
          }  
		  
		  /*MAIN:*/{
		  $(document).ready(function(){
            avvio_rapido ? avvia_gioco() : carica_div_preload();
          });
		  }
		  
		  /*Funzioni:*/{
		  function carica_div_preload(){
            presentazione_gioco();
          }
		  
		  function presentazione_gioco(){//presentazione gioco
		    //log:
			var_log += (((new Date()).toTimeString()).split(' ')[0]) + " : <b style='color: green;'> Presentazione Gioco</b><br />";
		  
		    //bottoni:
			var bottone_avvia_gioco = '<a class="btn btn-default" href="#" role="button" onclick="avvia_gioco()">Avvia il gioco</a>';
			var bottone_pres_regole = '<a class="btn btn-default" href="#" role="button" onclick="presentazione_regole()">Presentazione delle regole</a>';
			
			$('#contenitore_campo_console').html('<div id="div_regole" style="background-color: blue; height: 500px; width: 100%; display: none;" class="center"><b><u><h1 class="center marginpadding">Presentazione del gioco</h1></u></b><p><p></p><p style="padding: 10;">Questo gioco nasce con la finalità di ...<p><p>'+bottone_avvia_gioco+'   '+bottone_pres_regole+'</p></div>');
            $('#div_regole').fadeIn(3500);
		  }
		  
		  function presentazione_regole(){//presentazione regole
		    //log:
			var_log += (((new Date()).toTimeString()).split(' ')[0]) + " : <b style='color: green;'> Presentazione Regole</b><br />";
		  
			//bottoni:
			var bottone_avvia_gioco = '<a class="btn btn-default" href="#" role="button" onclick="avvia_gioco()">Avvia il gioco</a>';
		    
			$('#contenitore_campo_console').html('<div id="div_regole" style="background-color: red; height: 500px; width: 100%; display: none;" class="center"><h1 class="center marginpadding">descrizione regole gioco</h1><p style="padding: 10;">Testo delle regole<p><p>'+bottone_avvia_gioco+'</p></div>');
            $('#div_regole').fadeIn(3500);
		  }

		  function avvia_gioco(){//avvia gioco
            //crea il campo
			$('#campo_totale').html(codice_campo_console);
			crea_campo_gioco();
			 
			//carica la mappa
			carica_livello(livello, mappa);
			 
			//Carica oggetti
			carica_sprite("Personaggio", 0, personaggio_img);//personaggio
			carica_sprite("Exit", 0, exit_img);//exit
		     
			/*scrive nel log:*/{
            $("#log_eventi").append(""
			    + var_log
			    + (((new Date()).toTimeString()).split(' ')[0]) 
				+ " : <b style='color: green;'>"
                + "  Avvio Gioco"
				+ "</b><br />                 { " 
				+ "Personaggio [" + (posizioni[0].coordinate) + "] - "
				+ "Exit [" + (posizioni[1].coordinate) + "]"
				+" }"
				+"<br />"
			  );
			}
			
			if(var_debug){//Debug
				alert("Personaggio " + "\n"
					  + "pos: " + posizioni[0].coordinate + "\n"
					  + "riga: " + posizioni[0].riga + "\n"
					  + "colonna: " + posizioni[0].colonna + "\n"
                      
					  +"\nExit " + "\n"
					  + "pos: " + posizioni[1].coordinate + "\n"
					  + "riga: " + posizioni[1].riga + "\n"
					  + "colonna: " + posizioni[1].colonna + "\n"
					 );
			}
			
          }

		  function crea_campo_gioco(){//crea la griglia del campo
		    //crea il campo da gioco
		    content = '<div class="table-responsive"><table id="tabella_campo" class="table table-no-border marginpadding">';
			
			for (i = 0; i < num_righe; i++) {
              content += "<tr></tr>";
              for (j = 0; j < num_colonne; j++) {			  
                content += "<td id='" + i + sep_rig_col + j + "'><b style='color: " + background_color_campo + ";'>" + pos_vuota + "</b></td>";
              };
            };
			
            content += "</table></div>";
            $('.campo').append(content);
		  }

		  function random_posizione(){//genera random una posizione
            //righe
            var temp_pos_riga = Math.floor(Math.random() * (num_righe - 1)) + 0;
            //colonne
            var temp_pos_colonna = Math.floor(Math.random() * (num_colonne - 1)) + 0;
			
            return temp_pos_riga + sep_rig_col + temp_pos_colonna;
          }
		  
		  function posizione_personaggio_array(){
		    //memorizza l'indice della posizione del personaggio
			var loc_arr_pos = 0;
			//trova la posizione del personaggio nell'array
			
			while ((posizioni[loc_arr_pos].oggetto) != "Personaggio"){
			   
			   if (var_debug) {//Debug
			      alert("Posizione: " + loc_arr_pos + " Valore: " + posizioni[loc_arr_pos].oggetto);
			   }  			   
			   
			   loc_arr_pos += 1;
			};
			
		    return loc_arr_pos;
		  }
		  
		  function spostamento_personaggio(azione, spostamento, simula){//simula o effettua lo spostamento del msg	    
			
			var loc_arr_pos = posizione_personaggio_array();
			
			var pos_teorica_pers_riga    = posizioni[loc_arr_pos].riga;
			var pos_teorica_pers_colonna = posizioni[loc_arr_pos].colonna;
			
			if(var_debug){//debug
				alert("Spost_Pers \n"
					  + azione +", "+ spostamento +", "+ simula + "\n"
					  + "pers.riga: "    + posizioni[loc_arr_pos].riga + " | " + pos_teorica_pers_riga + "\n"
					  + "pers.colonna: " + posizioni[loc_arr_pos].colonna + " | " + pos_teorica_pers_colonna
					 );
			}
			
			switch(azione){//calcola le nuove coordinate
				   case "Nord"       :
				   case "Su"         :						   
									   pos_teorica_pers_riga -= spostamento; 
						break;
				   case "Sud"        :
				   case "Giu"        :						   
									   pos_teorica_pers_riga += spostamento; 
						break;
				   case "Est"        :
				   case "Destra"     :
									   pos_teorica_pers_colonna += spostamento; 
						break;
				   case "Ovest"      :
				   case "Sinistra"   :						   
									   pos_teorica_pers_colonna -= spostamento; 
						break;
				   case "Nord-Ovest" :
									   pos_teorica_pers_riga -= spostamento;
									   pos_teorica_pers_colonna -= spostamento;
						break;
				   case "Sud-Ovest"  : 
									   pos_teorica_pers_riga += spostamento;
									   pos_teorica_pers_colonna -= spostamento;
						break;
				   case "Nord-Est"   :
									   pos_teorica_pers_riga -= spostamento;
									   pos_teorica_pers_colonna += spostamento;
						break;
				   case "Sud-Est"    : 
									   pos_teorica_pers_riga += spostamento;
									   pos_teorica_pers_colonna += spostamento;
						break;
			}
			
			if (simula != "si"){//effettua la variazione delle coordinate del personaggio
				posizioni[loc_arr_pos].riga = pos_teorica_pers_riga;
				posizioni[loc_arr_pos].colonna = pos_teorica_pers_colonna;
				posizioni[loc_arr_pos].coordinate = pos_teorica_pers_riga + sep_rig_col + pos_teorica_pers_colonna;
			}
			
			if(var_debug){//debug
				alert("Sim spost Personaggio " + "\n"
					  + "pos: " + posizioni[loc_arr_pos].coordinate + "|" + pos_teorica_pers_riga + sep_rig_col + pos_teorica_pers_colonna + "\n"
					  + "riga: " + posizioni[loc_arr_pos].riga + " | " + pos_teorica_pers_riga + "\n"
					  + "colonna: " + posizioni[loc_arr_pos].colonna + " | " + pos_teorica_pers_colonna + "\n"
					 );
			}
			
			return (pos_teorica_pers_riga + sep_rig_col + pos_teorica_pers_colonna);
		  
		  }
		  		  
		  function carica_sprite(var_oggetto, var_number, sprite){//carica l'oggetto
		    var temp_posizione = "";
			
			while (posizione_utilizzata(temp_posizione = random_posizione()));//cicla finche non trova una posizione valida
			
			//carica sprite
			$("#"+temp_posizione).html(sprite);
            
			//posizione nell'array:
            var temp_pos_vettore = posizioni.length;
			
			//temp_posizione:
			var temp_riga = parseInt(temp_posizione.substring(temp_posizione, temp_posizione.indexOf(sep_rig_col)));
			var temp_colonna = parseInt(temp_posizione.substring(temp_posizione.indexOf(sep_rig_col) + 1));
			
			//aggiungo elemento all'array
			posizioni[temp_pos_vettore]= {coordinate:temp_posizione, oggetto: var_oggetto, number: var_number, riga: temp_riga, colonna: temp_colonna};
			
			if(var_debug){//Debug
					   alert("Array agg:" + "\n"
							  + posizioni[temp_pos_vettore]
							 );
					 }
			
			//ritorna la posizione utilizzata
			return temp_posizione;
		  }
 
		  function verifica_comando(comando, azione, passi){//verifica validità comando
		    return (    sintassi_comando_errata(comando, azione, passi)
					 || spostamento_comando_non_valido(comando, azione, passi)
					 || ostacoli_nel_tragitto(comando, azione, passi)
			       );    
		  }
		  	  
		  function spostamento_comando_non_valido(comando, azione, passi){//spostamento valido
		    
			if (passi > 0) { 
			        //calcola posizione
			        var sim_agg_pos = spostamento_personaggio(azione, passi, 'si');
					
					//riga
					var sim_riga_pers = sim_agg_pos.substring(0,sim_agg_pos.indexOf(sep_rig_col));
					
					//colonna
					var sim_colonna_pers = sim_agg_pos.substring(sim_agg_pos.indexOf(sep_rig_col)+1);
			    }
				
			return (     //valore negativo
			             (passi < 1)
			          || //riga
						 ( sim_riga_pers < 0 || sim_riga_pers > (num_righe -1) )
						 //colonna
					  || ( sim_colonna_pers < 0 || sim_colonna_pers > (num_colonne -1) )
			        );
		  }
		  
		  function sintassi_comando_errata(comando, azione, passi){//sintassi comando valida
			return (//comando validi:
						(azione != "Nord")        && (azione != "Su")
					 && (azione != "Nord-Est") 
					 && (azione != "Nord-Ovest") 
					 
					 && (azione != "Sud")         && (azione != "Giu")
					 && (azione != "Sud-Est") 
					 && (azione != "Sud-Ovest")
					 
					 && (azione != "Est")         && (azione != "Destra")   
					 && (azione != "Ovest")       && (azione != "Sinistra")
					);
		  }
		  
          function esegui_comando(){//esegue lo spostamento
			
            var comando = $("#comando").val();
            comando = $.trim(comando);
            
			if (comando!=""){
			
				var azione = comando.substring(0,comando.indexOf("("));
				var passi = parseInt(comando.substring(comando.indexOf("(")+1,comando.indexOf(")")));
				
				//per log indica orario comando:
				var data_ora = new Date();
				var date_ora_text = (data_ora.toTimeString()).split(' ')[0];
				
				//tempo trascorso:
				var tempo_elapsed_text = "";//" [" + (data_avvio_gioco - data_ora) +"]";
				
				//log:
				var temp_log ="";
				
				if (verifica_comando(comando, azione, passi)) 
				       {//comando errato
						/*temp log:*/{
						temp_log =   ""
								   + date_ora_text 
								   + tempo_elapsed_text
								   + " : <b style='color: red;'>"
								   + "<u>"   
								   + comando
								   + " <BIG>*</BIG>"
								   + "</u>"
								   + "</b><br />";
					    }
					   } 
				  else {//comando valido
						var loc_arr_pos = posizione_personaggio_array();
					
						for (shift = 0; shift < passi; shift++) {
							//nasconde personaggio
							$("#personaggio").fadeOut(1500);
							//evidenzia percorso
							$("#"+(posizioni[loc_arr_pos].coordinate)).html(pos_attraversata);
							//aggiorna riferimenti personaggio
							spostamento_personaggio(azione, 1, 'no');
                            //rivisualizza il personaggio
							$("#"+posizioni[loc_arr_pos].coordinate).html(personaggio_img).fadeIn(1000);
						}
						
						/*temp log:*/{
						temp_log =   ""
								   + date_ora_text 
								   + tempo_elapsed_text
								   + " : <b style='color: blue;'>"
								   +" [" + (posizioni[loc_arr_pos].coordinate) + "] : "
								   + comando
								   +"</b><br />";
					    }
					   }
				  
				//aggiorna log:
				var_log += temp_log;
				$("#log_eventi").append(temp_log);
			}
          }
		  
		  function posizione_utilizzata(test_posizione){
		    //controllo ciclo
			posizione_occupata = false;	
		  
		    for (i = 0; i < posizioni.length; i++){
				if (posizioni[i].coordinate == test_posizione) {
					posizione_occupata = true;
				}
				
				if(var_debug){//Debug
					alert("Ver posizione" + "\n"
						  + "utilizzata: " + posizioni[i].coordinate 
						  + " | " 
						  + "proposta:   " + test_posizione
						 );
				}
			}
			
			return posizione_occupata;
		  }
		  
		  function ostacolo_nella_posizione(test_posizione){//verifica ostacolo nella posizione
		    //controllo ciclo
			ostacolo_presente = false;	
		  
		    for (i = 0; i < posizioni.length; i++){
				if ((posizioni[i].coordinate == test_posizione) && (posizioni[i].oggetto =='Ostacolo')) {
					ostacolo_presente = true;
				}
				
				if(true){//var_debug){//Debug
					alert("Ver posizione Ostacolo" + "\n"
						  + "utilizzata: " + posizioni[i].coordinate  
						  + " | "  + "tipo: " + posizioni[i].oggetto + "\n"
						  + "proposta:   " + test_posizione
						 );
				}
			}
			
			return ostacolo_presente;
		  }
		  
		  function ostacoli_nel_tragitto(comando, azione, passi){//verifica presenza ostacoli lungo il tragitto
			/*
			for (i = 0; i < passi; i++){
				ostacolo_nella_posizione(spostamento_personaggio(azione, 1, "si"));
			}
			*/
			return false;
		  }

		  }
		  
		  /*Da implementare:*/{
		  function completato_livello(){//verifica se completato livello
		  
		  }
          
          function raggiunto_obbiettivo_completato_liv(pos_personaggio){//verifica se la posizione raggiunta corrisponde ad un obbiettivo

		  }
		  
		  function carica_livello(livello, mappa){//carica il livello
		    /*
			  deve leggere la mappa e caricare nelle posizioni corrette gli sprite con 
			  carica_sprite(var_oggetto, var_number, sprite)
			*/
		  }
		  
		  }
		  
		</script>
    </body>
</html>